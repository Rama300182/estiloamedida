
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Estilo a Medida | Tu hogar, tu estilo</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/comodas.css">
  <link rel="stylesheet" href="css/placards.css">
  <link rel="stylesheet" href="css/racks.css">
  <link rel="stylesheet" href="css/detalle-producto.css">
  <link rel="stylesheet" href="css/whatsapp-float.css">
  <link rel="stylesheet" href="css/newsletter.css">
  <link rel="icon" type="image/png" href="image/logo.png">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Supabase JS (usando jsdelivr por ser más confiable que unpkg) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
  
  <!-- Scripts de la aplicación en orden -->
  <script src="config/supabase.js" defer></script>
  <script src="js/products.service.js" defer></script>
  <script src="js/leads.service.js" defer></script>
  <script src="js/newsletter.js" defer></script>
  <script src="js/placards.js" defer></script>
  <script src="js/racks.js" defer></script>
</head>
<body>
  <header>
    <div class="container">
      <nav>
        <div class="logo">
          <a href="index.html">
            <img src="image/logo.png" alt="Estilo a Medida Logo">
          </a>
        </div>
        <div class="nav-links">
          <a href="index.html#inicio">Inicio</a>
          <a href="index.html#categorias">Categorías</a>
          <a href="index.html#proyectos">Proyectos</a>
          <a href="contacto.html">Contacto</a>
        </div>
        <a href="https://www.instagram.com/estilo.a.medida" target="_blank" class="social-icon">
          <i class="fab fa-instagram"></i>
        </a>
      </nav>
    </div>
  </header>

  <section class="category-header">
    <div class="container">
      <h1>Cómodas <span>a Medida</span></h1>
      <p>Piezas funcionales que combinan elegancia y practicidad para organizar tus espacios con estilo</p>
    </div>
  </section>

  <section class="filter-section">
    <div class="container">
      <div class="filters">
        <button class="filter-btn active" data-filter="all">Todos</button>
        <button class="filter-btn" data-filter="modernos">Modernos</button>
        <button class="filter-btn" data-filter="clasicos">Clásicos</button>
        <button class="filter-btn" data-filter="nordicos">Nórdicos</button>
      </div>
    </div>
  </section>

  <section class="products">
    <div class="container">
      <!-- Loading bar -->
      <div id="products-loading" class="loading-spinner">
        <div class="loading-bar"></div>
        <div class="loading-text">Cargando productos...</div>
      </div>
      
      <!-- Error message -->
      <div id="products-error" class="error-message" style="display: none;">
        <p>Error al cargar los productos. Por favor, recarga la página.</p>
        <button onclick="cargarProductosComodas()" class="retry-btn">Reintentar</button>
      </div>

      <!-- Products grid - Se llenará dinámicamente -->
      <div class="products-grid" id="products-grid" style="display: none;">
        <!-- Los productos se cargarán aquí desde Supabase -->
      </div>
    </div>
  </section>

  <section class="product-detail">
    <div class="container">
      <div class="product-modal">
        <div class="modal-close">×</div>
        <div class="modal-content">
          <div class="modal-gallery">
            <div class="gallery-main">
              <img id="main-image" src="" alt="Producto">
            </div>
            <div class="gallery-thumbs">
              <!-- Thumbnails will be loaded dynamically -->
            </div>
          </div>
          <div class="modal-info">
            <h2 id="product-title"></h2>
            <div class="product-description">
              <p id="product-description"></p>
            </div>
            <div class="product-features">
              <h3>Características</h3>
              <ul id="product-features">
                <!-- Features will be loaded dynamically -->
              </ul>
            </div>
            <div class="product-materials">
              <h3>Colores disponibles</h3>
              <div class="materials-list" id="product-materials">
                <!-- Materials will be loaded dynamically -->
              </div>
            </div>
            <div class="product-actions">
              <a href="#" class="btn btn-primary">Solicitar cotización</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="cta-section">
    <div class="container">
      <div class="cta-content">
        <h2>¿Buscas una <span>cómoda personalizada</span>?</h2>
        <p>Diseñamos muebles que se adaptan perfectamente a tus necesidades y espacio</p>
        <a href="index.html#contacto" class="btn">Contáctanos</a>
      </div>
    </div>
  </section>

  </section>

  <footer>
    <div class="container">
      <div class="footer-content">
        <div class="footer-col">
          <h4>Estilo a Medida</h4>
          <p>Tu hogar, tu estilo. Creamos muebles a la medida de tus sueños, combinando diseño, funcionalidad y estética.</p>
          <div class="footer-social">
            <a href="https://www.instagram.com/estilo.a.medida" target="_blank" class="social-icon">
              <i class="fab fa-instagram"></i>
            </a>
            <a href="#" class="social-icon">
              <i class="fab fa-facebook-f"></i>
            </a>
            <a href="#" class="social-icon">
              <i class="fab fa-pinterest"></i>
            </a>
          </div>
        </div>
        <div class="footer-col">
          <h4>Enlaces rápidos</h4>
          <ul>
            <li><a href="index.html">Inicio</a></li>
            <li><a href="index.html#categorias">Categorías</a></li>
            <li><a href="index.html#nosotros">Nosotros</a></li>
            <li><a href="index.html#proyectos">Proyectos</a></li>
            <li><a href="contacto.html">Contacto</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h4>Contáctanos</h4>
          <ul>
            <li><i class="fas fa-map-marker-alt"></i> Av. Ejemplo 1234, Santiago</li>
            <li><i class="fas fa-phone"></i> 11-7393-1253</li>
            <li><i class="fas fa-envelope"></i> estiloamedidaideas@gmail.com</li>
          </ul>
        </div>
      </div>
      <div class="copyright">
        <p>&copy; 2025 Estilo a Medida. Todos los derechos reservados.</p>
      </div>
    </div>
  </footer>

  <!-- Botón flotante de WhatsApp -->
  <a href="https://wa.me/5491173931253?text=¡Hola! Me interesa conocer más sobre los muebles de Estilo a Medida" 
     class="whatsapp-float" 
     target="_blank"
     aria-label="Contactar por WhatsApp">
    <i class="fab fa-whatsapp"></i>
  </a>
  
  <script src="js/comoda.js"></script>
  <script src="js/whatsapp.js"></script>

<!-- Script para cargar productos de cómodas dinámicamente -->
<script>
// Función para cargar productos de cómodas
async function cargarProductosComodas() {
  const loadingEl = document.getElementById('products-loading');
  const errorEl = document.getElementById('products-error');
  const gridEl = document.getElementById('products-grid');

  // Mostrar loading, ocultar error y grid
  loadingEl.style.display = 'block';
  errorEl.style.display = 'none';
  gridEl.style.display = 'none';

  try {
    console.log('Cargando productos de cómodas...');
    
    // Intentar obtener por categoría primero
    let resultado = await productsService.getProductosByCategoria('comodas');
    console.log('Resultado productos cómodas:', resultado);
    
    // Si no funciona por categoría, filtrar por nombre (temporal)
    if (!resultado.success || resultado.data.length === 0) {
      console.log('Fallback: filtrando todos los productos por nombre que contenga "cómoda"');
      const todosProductos = await productsService.getAllProductos();
      
      if (todosProductos.success) {
        resultado = {
          success: true,
          data: todosProductos.data.filter(producto => 
            producto.nombre.toLowerCase().includes('cómoda') ||
            producto.nombre.toLowerCase().includes('comoda')
          )
        };
      }
    }
    
    if (resultado.success && resultado.data.length > 0) {
      // Generar HTML para todos los productos
      const productosHTML = resultado.data.map(producto => 
        productsService.generarTarjetaProducto(producto)
      ).join('');
      
      gridEl.innerHTML = productosHTML;
      
      // Ocultar loading, mostrar grid
      loadingEl.style.display = 'none';
      gridEl.style.display = 'grid';
      
      console.log(`✅ Cargados ${resultado.data.length} productos de cómodas`);
      
      // Reinicializar filtros si existe la función
      if (typeof initializeFilters === 'function') {
        initializeFilters();
      }
      
    } else {
      throw new Error('No se encontraron productos de cómodas');
    }
    
  } catch (error) {
    console.error('Error al cargar productos:', error);
    
    // Mostrar error, ocultar loading
    loadingEl.style.display = 'none';
    errorEl.style.display = 'block';
  }
}

// Cargar productos cuando la página esté lista
document.addEventListener('DOMContentLoaded', () => {
  // Esperar a que los servicios estén listos
  setTimeout(() => {
    if (typeof productsService !== 'undefined' && productsService) {
      cargarProductosComodas();
    } else {
      console.error('ProductsService no está disponible');
      document.getElementById('products-loading').style.display = 'none';
      document.getElementById('products-error').style.display = 'block';
    }
  }, 1000); // Aumentar tiempo de espera
});
</script>

</body>
</html>