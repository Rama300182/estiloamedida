<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Estilo a Medida | Tu hogar, tu estilo</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/comodas.css">
  <link rel="stylesheet" href="css/placards.css">
  <link rel="stylesheet" href="css/racks.css">
  <link rel="stylesheet" href="css/detalle-producto.css">
  <link rel="stylesheet" href="css/whatsapp-float.css">
  <link rel="stylesheet" href="css/newsletter.css">
  <link rel="icon" type="image/png" href="image/logo.png">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Supabase JS (usando jsdelivr por ser más confiable que unpkg) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.min.js"></script>
  
  <!-- Scripts de la aplicación en orden -->
  <script src="config/supabase.js" defer></script>
  <script src="js/products.service.js" defer></script>
  <script src="js/leads.service.js" defer></script>
  <script src="js/newsletter.js" defer></script>
  <script src="js/placards.js" defer></script>
  <script src="js/racks.js" defer></script>
</head>
<body>
  <header>
    <div class="container">
      <nav>
        <div class="logo">
          <a href="index.html">
            <img src="image/logo.png" alt="Estilo a Medida Logo">
          </a>
        </div>
        <div class="nav-links">
          <a href="index.html#inicio">Inicio</a>
          <a href="index.html#categorias">Categorías</a>
          <a href="index.html#proyectos">Proyectos</a>
          <a href="contacto.html">Contacto</a>
        </div>
        <a href="https://www.instagram.com/estilo.a.medida" target="_blank" class="social-icon">
          <i class="fab fa-instagram"></i>
        </a>
      </nav>
    </div>
  </header>

  <section class="category-header">
    <div class="container">
      <h1>Placards <span>a Medida</span></h1>
      <p>Soluciones de almacenamiento inteligente que maximizan el espacio y se adaptan perfectamente a tus necesidades</p>
    </div>
  </section>

  <section class="filter-section">
    <div class="container">
      <div class="filters">
        <button class="filter-btn active" data-filter="all">Todos</button>
        <button class="filter-btn" data-filter="modernos">Modernos</button>
        <button class="filter-btn" data-filter="clasicos">Clásicos</button>
        <button class="filter-btn" data-filter="minimalista">Minimalista</button>
      </div>
    </div>
  </section>

  <section class="products">
    <div class="container">
      <!-- Loading bar -->
      <div id="products-loading" class="loading-spinner">
        <div class="loading-bar"></div>
        <div class="loading-text">Cargando productos...</div>
      </div>
      
      <!-- Error message -->
      <div id="products-error" class="error-message" style="display: none;">
        <p>Error al cargar los productos. Por favor, recarga la página.</p>
        <button onclick="cargarProductosPlacards()" class="retry-btn">Reintentar</button>
      </div>

      <!-- Products grid - Se llenará dinámicamente -->
      <div class="products-grid" id="products-grid" style="display: none;">
        <!-- Los productos se cargarán aquí desde Supabase -->
      </div>
    </div>
  </section>

  <section class="product-detail">
    <div class="container">
      <div class="product-modal">
        <div class="modal-close">×</div>
        <div class="modal-content">
          <div class="modal-gallery">
            <div class="gallery-main">
              <img id="modal-main-image" src="" alt="">
            </div>
            <div class="gallery-thumbnails">
              <!-- Las miniaturas se generarán dinámicamente -->
            </div>
          </div>
          <div class="modal-info">
            <h2 id="modal-product-name"></h2>
            <p id="modal-product-description"></p>
            <div class="product-specs">
              <h3>Especificaciones:</h3>
              <ul id="modal-product-specs">
                <!-- Las especificaciones se generarán dinámicamente -->
              </ul>
            </div>
            <div class="product-price">
              <span id="modal-product-price"></span>
            </div>
            <button class="contact-btn">Consultar</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer>
    <div class="container">
      <div class="footer-content">
        <div class="footer-col">
          <h4>Estilo a Medida</h4>
          <p>Tu hogar, tu estilo. Creamos muebles a la medida de tus sueños, combinando diseño, funcionalidad y estética.</p>
          <div class="footer-social">
            <a href="https://www.instagram.com/estilo.a.medida" target="_blank" class="social-icon">
              <i class="fab fa-instagram"></i>
            </a>
            <a href="#" class="social-icon">
              <i class="fab fa-facebook-f"></i>
            </a>
            <a href="#" class="social-icon">
              <i class="fab fa-pinterest"></i>
            </a>
          </div>
        </div>
        <div class="footer-col">
          <h4>Enlaces rápidos</h4>
          <ul>
            <li><a href="index.html">Inicio</a></li>
            <li><a href="index.html#categorias">Categorías</a></li>
            <li><a href="index.html#nosotros">Nosotros</a></li>
            <li><a href="index.html#proyectos">Proyectos</a></li>
            <li><a href="contacto.html">Contacto</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <h4>Contáctanos</h4>
          <ul>
            <li><i class="fas fa-map-marker-alt"></i> Av. Ejemplo 1234, Santiago</li>
            <li><i class="fas fa-phone"></i> 11-7393-1253</li>
            <li><i class="fas fa-envelope"></i> estiloamedidaideas@gmail.com</li>
          </ul>
        </div>
      </div>
      <div class="copyright">
        <p>&copy; 2025 Estilo a Medida. Todos los derechos reservados.</p>
      </div>
    </div>
  </footer>

  <!-- Botón flotante de WhatsApp -->
  <a href="https://wa.me/5491173931253?text=¡Hola! Me interesa conocer más sobre los muebles de Estilo a Medida" 
     class="whatsapp-float" 
     target="_blank"
     aria-label="Contactar por WhatsApp">
    <i class="fab fa-whatsapp"></i>
  </a>
  
  <script src="js/comoda.js"></script>
  <script src="js/whatsapp.js"></script>

<script>
// Función para cargar productos de placards desde Supabase
async function cargarProductosPlacards() {
  const loadingEl = document.getElementById('products-loading');
  const errorEl = document.getElementById('products-error');
  const gridEl = document.getElementById('products-grid');
  
  try {
    console.log('Iniciando carga de productos de placards...');
    
    // Mostrar loading, ocultar error y grid
    loadingEl.style.display = 'block';
    errorEl.style.display = 'none';
    gridEl.style.display = 'none';
    
    // Intentar obtener por categoría primero
    let resultado = await productsService.getProductosByCategoria('placares');
    console.log('Resultado de productos de placards:', resultado);
    
    // Si no funciona por categoría, filtrar por nombre (temporal)
    if (!resultado.success || resultado.data.length === 0) {
      console.log('Fallback: filtrando todos los productos por nombre que contenga "placard"');
      const todosProductos = await productsService.getAllProductos();
      
      if (todosProductos.success) {
        resultado = {
          success: true,
          data: todosProductos.data.filter(producto => 
            producto.nombre.toLowerCase().includes('placard') ||
            producto.nombre.toLowerCase().includes('vestidor') ||
            producto.nombre.toLowerCase().includes('ropero')
          )
        };
      }
    }
    
    if (resultado.success && resultado.data && resultado.data.length > 0) {
      // Ocultar loading y mostrar grid
      loadingEl.style.display = 'none';
      gridEl.style.display = 'grid';
      
      // Limpiar grid
      gridEl.innerHTML = '';
      
      // Generar HTML para cada producto usando el método del servicio
      const productosHTML = resultado.data.map(producto => 
        productsService.generarTarjetaProducto(producto)
      ).join('');
      
      gridEl.innerHTML = productosHTML;
      
    } else if (resultado.success && (!resultado.data || resultado.data.length === 0)) {
      // No hay productos en esta categoría
      loadingEl.style.display = 'none';
      gridEl.style.display = 'grid';
      gridEl.innerHTML = '<div style="text-align: center; padding: 40px; color: #666; grid-column: 1 / -1;"><h3>Próximamente</h3><p>Estamos preparando increíbles diseños de placards para ti.</p></div>';
    } else {
      throw new Error(resultado.error || 'No se encontraron productos de placards');
    }
    
  } catch (error) {
    console.error('Error al cargar productos:', error);
    
    // Mostrar error, ocultar loading
    loadingEl.style.display = 'none';
    errorEl.style.display = 'block';
  }
}

// Cargar productos cuando la página esté lista
document.addEventListener('DOMContentLoaded', () => {
  // Esperar a que los servicios estén listos
  setTimeout(() => {
    if (typeof productsService !== 'undefined' && productsService) {
      cargarProductosPlacards();
    } else {
      console.error('ProductsService no está disponible');
      document.getElementById('products-loading').style.display = 'none';
      document.getElementById('products-error').style.display = 'block';
    }
  }, 1000); // Aumentar tiempo de espera
});
</script>

</body>
</html>